"""
Large Persian Dataset Downloader
دانلود دیتاست‌های بزرگ فارسی
"""
import requests
import json
import os
from backend.core.fox_learning import FoxLearningSystem
from backend.core.user_profiles import user_manager

class LargeDatasetDownloader:
    def __init__(self):
        self.data_dir = "data/large_datasets"
        self.ensure_data_dir()
        
    def ensure_data_dir(self):
        os.makedirs(self.data_dir, exist_ok=True)
        
    def download_persian_qa_dataset(self):
        """دانلود دیتاست سوال و جواب فارسی"""
        print("📚 دانلود دیتاست سوال و جواب فارسی...")
        
        qa_dataset = [
            {"q": "سلام", "a": "سلام! چطوری؟ خوش اومدی 😊"},
            {"q": "صبح بخیر", "a": "صبحت بخیر عزیز! روز خوبی داشته باشی ☀️"},
            {"q": "شب بخیر", "a": "شبت بخیر! خواب راحت 🌙"},
            {"q": "چطوری", "a": "خوبم ممنون! تو چطوری؟"},
            {"q": "حالت چطوره", "a": "عالی! ممنون که پرسیدی 😊"},
            {"q": "خوبی", "a": "آره خوبم! تو چطوری؟"},
            {"q": "چه خبر", "a": "سلامتی! تو چه خبر؟"},
            {"q": "کجایی", "a": "اینجام! تو کجایی؟"},
            {"q": "چیکار می‌کنی", "a": "دارم باهات حرف می‌زنم! تو چی؟"},
            {"q": "خسته‌ام", "a": "استراحت کن عزیز! سلامتی مهم‌تره"},
            {"q": "حوصلم سر رفته", "a": "بیا یه کار تفریحی بکنیم!"},
            {"q": "غمگینم", "a": "نگران نباش، همه چیز درست میشه 💙"},
            {"q": "خوشحالم", "a": "چه خبر خوبی! منم خوشحالم 🎉"},
            {"q": "عصبانیم", "a": "آروم باش، همه چیز حل میشه"},
            {"q": "استرس دارم", "a": "نگران نباش، کنارتم"},
            {"q": "ممنون", "a": "خواهش می‌کنم! همیشه کنارتم 😊"},
            {"q": "متشکرم", "a": "قابل نداره عزیز!"},
            {"q": "خداحافظ", "a": "خداحافظ! مراقب خودت باش 👋"},
            {"q": "بای", "a": "بای بای! به امید دیدار"},
            {"q": "فعلاً", "a": "فعلاً! زود برگرد"},
        ]
        
        return qa_dataset
        
    def download_persian_conversations(self):
        """دانلود مکالمات طولانی فارسی"""
        print("💬 دانلود مکالمات طولانی...")
        
        conversations = [
            {"q": "امروز چه برنامه‌ای داری", "a": "هیچ برنامه خاصی ندارم! تو چی؟"},
            {"q": "می‌خوام فیلم ببینم", "a": "چه فیلمی؟ کمدی دوست داری یا درام؟"},
            {"q": "کمدی خوبه", "a": "کمدی عالیه! خنده سلامتی میاره 😄"},
            {"q": "غذا خوردی", "a": "آره تازه خوردم! تو چی خوردی؟"},
            {"q": "پیتزا خوردم", "a": "اوه پیتزا! خیلی خوشمزه‌ست 🍕"},
            {"q": "آره خیلی خوب بود", "a": "خوشحالم که خوشت اومد!"},
            {"q": "کار داری فردا", "a": "آره متأسفانه! تو چی؟"},
            {"q": "منم دارم", "a": "پس هر دو مشغولیم! موفق باشی"},
            {"q": "ممنون تو هم", "a": "مرسی عزیز! امیدوارم روز خوبی داشته باشی"},
            {"q": "حتماً", "a": "عالیه! همیشه مثبت باش 😊"},
            {"q": "سعی می‌کنم", "a": "آفرین! این روحیه خوبه"},
            {"q": "تو چطور همیشه خوشحالی", "a": "چون دوستان خوبی مثل تو دارم! 💙"},
            {"q": "خیلی مهربونی", "a": "تو هم همینطور! قلب طلایی داری"},
            {"q": "لطف داری", "a": "نه واقعاً! تو آدم خوبی هستی"},
            {"q": "ممنون از محبتت", "a": "عزیز دلم! همیشه کنارتم"},
        ]
        
        return conversations
        
    def download_emotional_responses(self):
        """دانلود پاسخ‌های احساسی"""
        print("💝 دانلود پاسخ‌های احساسی...")
        
        emotional_data = [
            {"q": "دلم برات تنگ شده", "a": "منم دلم برات تنگ شده! 💙"},
            {"q": "دوست دارم", "a": "منم دوست دارم! ❤️"},
            {"q": "عاشقتم", "a": "تو هم عزیز دلی! 😍"},
            {"q": "نگرانتم", "a": "نگران نباش، حواسم هست"},
            {"q": "دلواپسم", "a": "همه چیز درست میشه، نگران نباش"},
            {"q": "ترسیدم", "a": "نترس، من کنارتم"},
            {"q": "تنهام", "a": "تنها نیستی، من اینجام"},
            {"q": "احساس بدی دارم", "a": "چرا عزیز؟ چی شده؟"},
            {"q": "ناراحتم", "a": "بگو ببینم چی شده؟ کمک کنم"},
            {"q": "خوشحالم", "a": "منم خوشحالم! چه خبر خوبی؟"},
            {"q": "هیجان‌زده‌ام", "a": "واو! چه اتفاق خوبی افتاده؟"},
            {"q": "امیدوارم", "a": "امیدواری خوبه! همیشه امیدوار باش"},
            {"q": "مأیوسم", "a": "مأیوس نباش، فردا بهتر میشه"},
            {"q": "خسته شدم", "a": "استراحت کن، انرژیت رو جمع کن"},
            {"q": "انگیزه ندارم", "a": "گاهی همینطوره، ولی گذر میکنه"},
        ]
        
        return emotional_data
        
    def download_daily_conversations(self):
        """دانلود مکالمات روزانه"""
        print("🌅 دانلود مکالمات روزانه...")
        
        daily_data = [
            {"q": "صبحانه خوردی", "a": "آره! تو چی خوردی؟"},
            {"q": "نان و پنیر", "a": "کلاسیک! خوشمزه بوده؟"},
            {"q": "آره خوب بود", "a": "عالیه! صبحانه مهم‌ترین وعده‌ست"},
            {"q": "ناهار چی بخورم", "a": "چه چیزی دوست داری؟"},
            {"q": "غذای ایرانی", "a": "قورمه سبزی چطوره؟ یا کباب؟"},
            {"q": "قورمه سبزی عالیه", "a": "آره! با برنج خیلی خوشمزه‌ست"},
            {"q": "شام چی داریم", "a": "هنوز فکر نکردم! پیشنهاد داری؟"},
            {"q": "پیتزا بگیریم", "a": "ایده خوبیه! چه طعمی؟"},
            {"q": "قارچ و پپرونی", "a": "ترکیب عالی! منم دوست دارم"},
            {"q": "خرید رفتی", "a": "نه هنوز! تو رفتی؟"},
            {"q": "آره رفتم", "a": "چی خریدی؟"},
            {"q": "میوه و سبزی", "a": "عالیه! سلامتی مهمه"},
            {"q": "ورزش کردی", "a": "نه امروز نکردم! تو چی؟"},
            {"q": "یکم پیاده‌روی", "a": "خوبه! پیاده‌روی مفیده"},
            {"q": "خوابت می‌آد", "a": "یکم! تو چطوری؟"},
        ]
        
        return daily_data
        
    def download_all_datasets(self):
        """دانلود همه دیتاست‌ها"""
        print("🚀 شروع دانلود دیتاست‌های بزرگ...")
        
        all_data = []
        
        # دانلود دیتاست‌ها
        datasets = [
            self.download_persian_qa_dataset(),
            self.download_persian_conversations(), 
            self.download_emotional_responses(),
            self.download_daily_conversations()
        ]
        
        for dataset in datasets:
            all_data.extend(dataset)
            
        print(f"📥 مجموع {len(all_data)} مکالمه دانلود شد")
        
        return all_data
        
    def save_to_fox_brain(self, data):
        """ذخیره در مغز Fox"""
        print("🧠 ذخیره در مغز Fox...")
        
        profile = user_manager.get_current_user_profile()
        fox_learning = FoxLearningSystem(profile)
        
        saved_count = 0
        
        for item in data:
            try:
                fox_learning.teach_response(item["q"], item["a"])
                saved_count += 1
                
                if saved_count % 20 == 0:
                    print(f"✅ {saved_count} مکالمه ذخیره شد...")
                    
            except Exception as e:
                print(f"❌ خطا: {e}")
                
        print(f"🎉 مجموع {saved_count} مکالمه در مغز Fox ذخیره شد!")
        return saved_count
        
    def run_full_download(self):
        """اجرای کامل دانلود"""
        print("🌟 شروع دانلود دیتاست بزرگ...")
        
        # دانلود داده‌ها
        data = self.download_all_datasets()
        
        # ذخیره در فایل
        json_file = os.path.join(self.data_dir, "large_dataset.json")
        with open(json_file, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        print(f"💾 داده‌ها در {json_file} ذخیره شد")
        
        # ذخیره در مغز Fox
        saved_count = self.save_to_fox_brain(data)
        
        print("✅ دانلود کامل شد!")
        print(f"📊 آمار:")
        print(f"   - دانلود: {len(data)} مکالمه")
        print(f"   - ذخیره: {saved_count} مکالمه")
        
        return {
            "downloaded": len(data),
            "saved": saved_count,
            "file": json_file
        }

# Global instance
large_downloader = LargeDatasetDownloader()
